<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ•™è‚²è¼”å°å»ºè­°å°å·¥å…· - ç‰¹æ•™è€å¸«ç”¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --border: #e0e4f0;
      --accent: #4f46e5;
      --accent-soft: #e0e7ff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 20px;
    }

    .title-block h1 {
      margin: 0 0 6px;
      font-size: 1.4rem;
      font-weight: 700;
    }

    .title-block p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-sub);
    }

    .tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: var(--accent-soft);
      color: var(--accent);
      margin-left: 6px;
    }

    .toolbar {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--text-sub);
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .btn[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn-outline {
      background: #ffffff;
      color: var(--text-sub);
      border: 1px solid var(--border);
    }

    .btn-outline:hover:not([disabled]) {
      background: #f9fafb;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.3);
    }

    .btn-primary:hover:not([disabled]) {
      background: #4338ca;
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(79, 70, 229, 0.35);
    }

    .btn:active:not([disabled]) {
      transform: translateY(0);
      box-shadow: none;
    }

    .status-text {
      font-size: 0.78rem;
      color: var(--text-sub);
    }

    /* å¡ç‰‡ */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border);
      margin-bottom: 18px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .card-title {
      font-size: 0.98rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      background: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: var(--accent);
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      padding: 10px 12px;
      resize: vertical;
      min-height: 90px;
      font-size: 0.9rem;
      line-height: 1.5;
      font-family: inherit;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      background: #f9fafb;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #ffffff;
    }

    .helper-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--text-sub);
      gap: 8px;
      flex-wrap: wrap;
    }

    .counter {
      font-variant-numeric: tabular-nums;
    }

    /* å»ºè­°å€å¡Š */
    .suggestions-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .suggestions-grid {
        grid-template-columns: 1fr;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .toolbar {
        align-items: flex-start;
      }
    }

    .section-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 12px 14px;
      border: 1px solid var(--border);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.04);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
    }

    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .section-tag {
      font-size: 0.7rem;
      color: var(--text-sub);
      background: #f3f4ff;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .section-body {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 720px) {
      .section-body {
        grid-template-columns: 1fr;
      }
    }

    .section-column-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-sub);
      margin-bottom: 3px;
    }

    .small-textarea {
      min-height: 80px;
    }

    /* åŒ¯å‡ºå€å¡Š */
    .export-card {
      margin-top: 20px;
    }

    .export-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .export-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .export-note {
      font-size: 0.78rem;
      color: var(--text-sub);
    }

    .export-area {
      min-height: 120px;
      font-size: 0.85rem;
      white-space: pre-wrap;
    }

    .export-buttons {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="title-block">
      <h1>
        æ•™è‚²è¼”å°å»ºè­°å°å·¥å…·
        <span class="tag">ç‰¹æ•™è€å¸«ç”¨</span>
      </h1>
      <p>è²¼ä¸Šã€Œå­©å­èƒ½åŠ›ç¾æ³ã€ï¼Œå¯æ‰‹å‹•æ’°å¯«å»ºè­°ï¼Œä¹Ÿå¯ç”¨ AI å”åŠ©ç”¢ç”Ÿå…­å¤§å‘åº¦å»ºè­°ã€‚</p>
    </div>
    <div class="toolbar">
      <div class="badge">å…­å¤§å‘åº¦ï¼šç²—å¤§ãƒ»ç²¾ç´°ãƒ»èªçŸ¥ãƒ»èªè¨€ãƒ»ç¤¾æœƒæƒ…ç·’ãƒ»ç”Ÿæ´»è‡ªç†</div>
      <button class="btn btn-outline" type="button" onclick="clearAll()">
        ğŸ§¹ æ¸…é™¤å…¨éƒ¨å…§å®¹
      </button>
      <span id="aiStatus" class="status-text"></span>
    </div>
  </header>

  <!-- èƒ½åŠ›ç¾æ³è¼¸å…¥ -->
  <section class="card">
    <div class="card-header">
      <div class="card-title">
        <span class="icon">ğŸ“„</span>
        å­©å­èƒ½åŠ›ç¾æ³æ•´ç†ï¼ˆè¼¸å…¥å€ï¼‰
      </div>
      <button class="btn btn-primary" type="button" id="aiButton" onclick="generateWithAI()">
        ğŸ¤– ç”¨ AI ç”¢ç”Ÿå»ºè­°
      </button>
    </div>
    <p class="card-subtitle">
      å»ºè­°åŒ…å«å…­å¤§å‘åº¦çš„èªªæ˜ï¼Œä¾‹å¦‚ï¼š<br>
      ã€Œå€‹æ¡ˆåœ¨ç²—å¤§å‹•ä½œæ–¹é¢ï¼Œéœ€æå‡æ ¸å¿ƒè‚Œç¾¤ï¼Œå¯æŒçºŒè¨“ç·´çƒé¡é‹å‹•åŠå¹³è¡¡é …ç›®ï¼›ç²¾ç´°å‹•ä½œæ–¹é¢â€¦â€¦ã€
    </p>
    <textarea id="profileInput" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæˆ–æ•´ç†å­©å­çš„èƒ½åŠ›ç¾æ³æè¿°ï¼ˆå»ºè­°æ¶µè“‹å…­å¤§å‘åº¦ï¼‰ï¼Œå†æŒ‰å³ä¸Šè§’ã€Œç”¨ AI ç”¢ç”Ÿå»ºè­°ã€ã€‚"></textarea>
    <div class="helper-row">
      <span class="counter">å­—æ•¸ï¼š<span id="charCount">0</span></span>
      <button class="btn btn-outline" type="button" onclick="document.getElementById('profileInput').value='';updateCharCount();">
        æ¸…é™¤èƒ½åŠ›ç¾æ³
      </button>
    </div>
  </section>

  <!-- å…­å¤§å‘åº¦ å»ºè­°å€å¡Š -->
  <section class="suggestions-grid">
    <!-- ç²—å¤§å‹•ä½œ -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">ç²—å¤§å‹•ä½œ</div>
        <div class="section-tag">å§¿å‹¢æ§åˆ¶ãƒ»å¹³è¡¡ãƒ»çƒé¡ãƒ»è·‘è·³</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="grossParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="grossTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>

    <!-- ç²¾ç´°å‹•ä½œ -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">ç²¾ç´°å‹•ä½œ</div>
        <div class="section-tag">æ‰‹éƒ¨å°è‚Œè‚‰ãƒ»æ›¸å¯«ãƒ»ä»¿ç•«</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="fineParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="fineTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>

    <!-- èªçŸ¥ -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">èªçŸ¥</div>
        <div class="section-tag">æ¦‚å¿µãƒ»æ•¸æ¦‚å¿µãƒ»å•é¡Œè§£æ±º</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="cogParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="cogTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>

    <!-- èªè¨€ -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">èªè¨€</div>
        <div class="section-tag">ç†è§£ãƒ»è¡¨é”ãƒ»æ§‹éŸ³</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="langParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="langTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>

    <!-- ç¤¾æœƒæƒ…ç·’ -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">ç¤¾æœƒæƒ…ç·’</div>
        <div class="section-tag">äººéš›äº’å‹•ãƒ»æƒ…ç·’èª¿ç¯€ãƒ»è¦ç¯„</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="socParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="socTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>

    <!-- ç”Ÿæ´»è‡ªç† -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">ç”Ÿæ´»è‡ªç†</div>
        <div class="section-tag">å¦‚å»ãƒ»ç›¥æ´—ãƒ»æ•´ç†ç‰©å“</div>
      </div>
      <div class="section-body">
        <div>
          <div class="section-column-label">çµ¦å®¶é•·çš„å»ºè­°</div>
          <textarea id="adlsParent" class="small-textarea"></textarea>
        </div>
        <div>
          <div class="section-column-label">çµ¦æ™®ç­è€å¸«çš„å»ºè­°</div>
          <textarea id="adlsTeacher" class="small-textarea"></textarea>
        </div>
      </div>
    </div>
  </section>

  <!-- åŒ¯å‡ºæ•´ç†å€ -->
  <section class="card export-card">
    <div class="export-header">
      <div class="export-title">æ•´ç†æˆå ±å‘Šæ–‡å­—ï¼ˆè¤‡è£½ç”¨ï¼‰</div>
      <div class="export-note">æŒ‰ä¸‹ã€Œç”Ÿæˆæ•´ç†çµæœã€æœƒæŠŠèƒ½åŠ›ç¾æ³ï¼‹å…­å¤§å‘åº¦å»ºè­°æ•´ç†åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿è²¼é€² Word / IEPã€‚</div>
    </div>
    <textarea id="exportOutput" class="export-area" placeholder="æŒ‰ä¸‹ã€Œç”Ÿæˆæ•´ç†çµæœã€å¾Œï¼Œå…§å®¹æœƒé¡¯ç¤ºåœ¨é€™è£¡ã€‚"></textarea>
    <div class="export-buttons">
      <button class="btn btn-primary" type="button" onclick="generateExport()">
        âœ¨ ç”Ÿæˆæ•´ç†çµæœ
      </button>
      <button class="btn btn-outline" type="button" onclick="copyExport()">
        ğŸ“‹ è¤‡è£½æ•´ç†çµæœ
      </button>
    </div>
  </section>
</div>

<script>
  const profileInput = document.getElementById('profileInput');
  const charCount = document.getElementById('charCount');
  const aiButton = document.getElementById('aiButton');
  const aiStatus = document.getElementById('aiStatus');

  function updateCharCount() {
    charCount.textContent = profileInput.value.length;
  }

  profileInput.addEventListener('input', updateCharCount);
  updateCharCount();

  // ä¸€éµæ¸…é™¤å…¨éƒ¨æ¬„ä½
  function clearAll() {
    if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¬„ä½å…§å®¹å—ï¼Ÿ')) return;
    document.querySelectorAll('textarea').forEach(t => t.value = '');
    updateCharCount();
    aiStatus.textContent = '';
  }

  // ç”Ÿæˆæ•´ç†æ–‡å­—
  function generateExport() {
    const profile = document.getElementById('profileInput').value.trim();

    const data = {
      'ç²—å¤§å‹•ä½œ': {
        parent: document.getElementById('grossParent').value.trim(),
        teacher: document.getElementById('grossTeacher').value.trim()
      },
      'ç²¾ç´°å‹•ä½œ': {
        parent: document.getElementById('fineParent').value.trim(),
        teacher: document.getElementById('fineTeacher').value.trim()
      },
      'èªçŸ¥': {
        parent: document.getElementById('cogParent').value.trim(),
        teacher: document.getElementById('cogTeacher').value.trim()
      },
      'èªè¨€': {
        parent: document.getElementById('langParent').value.trim(),
        teacher: document.getElementById('langTeacher').value.trim()
      },
      'ç¤¾æœƒæƒ…ç·’': {
        parent: document.getElementById('socParent').value.trim(),
        teacher: document.getElementById('socTeacher').value.trim()
      },
      'ç”Ÿæ´»è‡ªç†': {
        parent: document.getElementById('adlsParent').value.trim(),
        teacher: document.getElementById('adlsTeacher').value.trim()
      }
    };

    let lines = [];

    if (profile) {
      lines.push('ã€ä¸€ã€å­©å­èƒ½åŠ›ç¾æ³ã€‘');
      lines.push(profile);
      lines.push('');
    }

    lines.push('ã€äºŒã€æ•™è‚²è¼”å°å»ºè­°ã€‘');

    Object.keys(data).forEach((key, index) => {
      const sec = data[key];
      if (!sec.parent && !sec.teacher) return;

      lines.push(`ï¼ˆ${index + 1}ï¼‰${key}`);
      if (sec.parent) {
        lines.push(`â€§çµ¦å®¶é•·çš„å»ºè­°ï¼š${sec.parent}`);
      }
      if (sec.teacher) {
        lines.push(`â€§çµ¦æ™®ç­è€å¸«çš„å»ºè­°ï¼š${sec.teacher}`);
      }
      lines.push('');
    });

    document.getElementById('exportOutput').value = lines.join('\n');
  }

  // è¤‡è£½æ•´ç†çµæœ
  function copyExport() {
    const output = document.getElementById('exportOutput');
    if (!output.value.trim()) {
      alert('ç›®å‰å°šæœªæœ‰æ•´ç†çµæœï¼Œè«‹å…ˆé»ã€Œç”Ÿæˆæ•´ç†çµæœã€ã€‚');
      return;
    }
    output.select();
    document.execCommand('copy');
    alert('å·²å°‡æ•´ç†çµæœè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
  }

  // ç”¨ AI ç”¢ç”Ÿå»ºè­°ï¼ˆå‘¼å«å¾Œç«¯ Python APIï¼‰
  async function generateWithAI() {
    const profile = profileInput.value.trim();
    if (!profile) {
      alert('è«‹å…ˆåœ¨ã€Œå­©å­èƒ½åŠ›ç¾æ³ã€è¼¸å…¥å…§å®¹ï¼Œå†æŒ‰ã€Œç”¨ AI ç”¢ç”Ÿå»ºè­°ã€ã€‚');
      return;
    }

    aiButton.disabled = true;
    aiStatus.textContent = 'ğŸ¤– æ­£åœ¨å‘ AI ç”¢ç”Ÿå»ºè­°ä¸­ï¼Œè«‹ç¨å€™â€¦';

    try {
      const res = await fetch('http://localhost:8787/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json; charset=utf-8'
        },
        body: JSON.stringify({ profile })
      });

      if (!res.ok) {
        throw new Error('ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤ç‹€æ…‹ï¼š' + res.status);
      }

      const data = await res.json();
      if (!data || !data.success || !data.suggestions) {
        throw new Error(data && data.message ? data.message : 'å›å‚³æ ¼å¼ä¸æ­£ç¢ºã€‚');
      }

      const s = data.suggestions;

      // å®‰å…¨å–å€¼çš„å°å·¥å…·
      function get(path, fallback = '') {
        return path.split('.').reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), s) ?? fallback;
      }

      document.getElementById('grossParent').value  = get('ç²—å¤§å‹•ä½œ.parent');
      document.getElementById('grossTeacher').value = get('ç²—å¤§å‹•ä½œ.teacher');

      document.getElementById('fineParent').value   = get('ç²¾ç´°å‹•ä½œ.parent');
      document.getElementById('fineTeacher').value  = get('ç²¾ç´°å‹•ä½œ.teacher');

      document.getElementById('cogParent').value    = get('èªçŸ¥.parent');
      document.getElementById('cogTeacher').value   = get('èªçŸ¥.teacher');

      document.getElementById('langParent').value   = get('èªè¨€.parent');
      document.getElementById('langTeacher').value  = get('èªè¨€.teacher');

      document.getElementById('socParent').value    = get('ç¤¾æœƒæƒ…ç·’.parent');
      document.getElementById('socTeacher').value   = get('ç¤¾æœƒæƒ…ç·’.teacher');

      document.getElementById('adlsParent').value   = get('ç”Ÿæ´»è‡ªç†.parent');
      document.getElementById('adlsTeacher').value  = get('ç”Ÿæ´»è‡ªç†.teacher');

      aiStatus.textContent = 'âœ… å·²ç”± AI ç”¢ç”Ÿå»ºè­°ï¼Œå¯è¦–éœ€è¦å†æ‰‹å‹•å¾®èª¿å…§å®¹ã€‚';
    } catch (err) {
      console.error(err);
      aiStatus.textContent = 'âŒ ç”¢ç”Ÿå¤±æ•—ï¼š' + err.message;
      alert('ç”¢ç”Ÿå»ºè­°æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + err.message);
    } finally {
      aiButton.disabled = false;
    }
  }
</script>
</body>
</html>
