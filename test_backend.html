<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¾Œç«¯æ¸¬è©¦å·¥å…·</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f7fb;
    }
    h1 { color: #4f46e5; }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    button {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #4338ca; }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .success {
      background: #d4edda;
      border: 1px solid #28a745;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #dc3545;
      color: #721c24;
    }
    .info {
      background: #d1ecf1;
      border: 1px solid #17a2b8;
      color: #0c5460;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª å¾Œç«¯æ¸¬è©¦å·¥å…·</h1>
  
  <div class="test-section">
    <h2>æ¸¬è©¦è³‡æ–™</h2>
    <textarea id="testProfile" placeholder="è¼¸å…¥æ¸¬è©¦ç”¨çš„å­©å­èƒ½åŠ›ç¾æ³...">å€‹æ¡ˆåœ¨ç²—å¤§å‹•ä½œæ–¹é¢ï¼Œéœ€æå‡æ ¸å¿ƒè‚Œç¾¤ï¼Œå¯æŒçºŒè¨“ç·´çƒé¡é‹å‹•åŠå¹³è¡¡é …ç›®ï¼›ç²¾ç´°å‹•ä½œæ–¹é¢ï¼Œæ‰‹éƒ¨å°è‚Œè‚‰æ§åˆ¶å°šå¯ï¼Œä½†æ›¸å¯«æ™‚å®¹æ˜“ç–²ç´¯ï¼›èªçŸ¥æ–¹é¢ï¼Œæ•¸æ¦‚å¿µéœ€åŠ å¼·ï¼›èªè¨€æ–¹é¢ï¼Œè¡¨é”èƒ½åŠ›è‰¯å¥½ä½†æ§‹éŸ³éœ€æ”¹å–„ï¼›ç¤¾æœƒæƒ…ç·’æ–¹é¢ï¼Œéœ€è¦å”åŠ©æƒ…ç·’èª¿ç¯€ï¼›ç”Ÿæ´»è‡ªç†æ–¹é¢ï¼Œå¦‚å»å’Œç›¥æ´—èƒ½åŠ›è‰¯å¥½ã€‚</textarea>
  </div>

  <div class="test-section">
    <h2>1ï¸âƒ£ æ¸¬è©¦ Python å¾Œç«¯ (Port 8787)</h2>
    <button onclick="testPython()">æ¸¬è©¦ Python API</button>
    <button onclick="checkPythonHealth()">æª¢æŸ¥ Python ä¼ºæœå™¨ç‹€æ…‹</button>
    <div id="pythonResult"></div>
  </div>

  <div class="test-section">
    <h2>2ï¸âƒ£ æ¸¬è©¦ PHP å¾Œç«¯ (Port 8000)</h2>
    <button onclick="testPHP()">æ¸¬è©¦ PHP API</button>
    <div id="phpResult"></div>
  </div>

  <div class="test-section">
    <h2>3ï¸âƒ£ é…ç½®æª¢æŸ¥</h2>
    <button onclick="checkConfig()">æª¢æŸ¥ config.js é…ç½®</button>
    <div id="configResult"></div>
  </div>

  <script src="config.js"></script>
  <script>
    // æ¸¬è©¦ Python å¾Œç«¯
    async function testPython() {
      const resultDiv = document.getElementById('pythonResult');
      resultDiv.innerHTML = '<div class="info">â³ æ¸¬è©¦ä¸­...</div>';
      
      const profile = document.getElementById('testProfile').value.trim();
      if (!profile) {
        resultDiv.innerHTML = '<div class="error">âŒ è«‹å…ˆè¼¸å…¥æ¸¬è©¦è³‡æ–™</div>';
        return;
      }

      try {
        const startTime = Date.now();
        const res = await fetch('http://localhost:8787/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profile })
        });
        const elapsed = Date.now() - startTime;

        const data = await res.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class="success">
âœ… Python å¾Œç«¯æ¸¬è©¦æˆåŠŸï¼
â±ï¸  å›æ‡‰æ™‚é–“: ${elapsed}ms
ğŸ“Š å›å‚³è³‡æ–™:
${JSON.stringify(data.suggestions, null, 2)}
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="error">
âŒ API å›å‚³éŒ¯èª¤
è¨Šæ¯: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}
            </div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="error">
âŒ é€£ç·šå¤±æ•—
éŒ¯èª¤: ${err.message}

è«‹ç¢ºèªï¼š
1. Python å¾Œç«¯å·²å•Ÿå‹• (python3 app.py æˆ– start_python.bat)
2. Port 8787 æ²’æœ‰è¢«å…¶ä»–ç¨‹å¼ä½”ç”¨
3. API Key å·²æ­£ç¢ºè¨­å®š
          </div>
        `;
      }
    }

    // æª¢æŸ¥ Python ä¼ºæœå™¨å¥åº·ç‹€æ…‹
    async function checkPythonHealth() {
      const resultDiv = document.getElementById('pythonResult');
      resultDiv.innerHTML = '<div class="info">â³ æª¢æŸ¥ä¸­...</div>';

      try {
        const res = await fetch('http://localhost:8787/', {
          method: 'GET'
        });
        
        if (res.ok) {
          resultDiv.innerHTML = `
            <div class="success">
âœ… Python ä¼ºæœå™¨é‹è¡Œä¸­
ç‹€æ…‹ç¢¼: ${res.status}
URL: http://localhost:8787
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="error">
âš ï¸  ä¼ºæœå™¨å›æ‡‰ç•°å¸¸
ç‹€æ…‹ç¢¼: ${res.status}
            </div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="error">
âŒ ç„¡æ³•é€£ç·šåˆ° Python ä¼ºæœå™¨
éŒ¯èª¤: ${err.message}

è«‹åŸ·è¡Œ: python3 app.py æˆ– start_python.bat
          </div>
        `;
      }
    }

    // æ¸¬è©¦ PHP å¾Œç«¯
    async function testPHP() {
      const resultDiv = document.getElementById('phpResult');
      resultDiv.innerHTML = '<div class="info">â³ æ¸¬è©¦ä¸­...</div>';
      
      const profile = document.getElementById('testProfile').value.trim();
      if (!profile) {
        resultDiv.innerHTML = '<div class="error">âŒ è«‹å…ˆè¼¸å…¥æ¸¬è©¦è³‡æ–™</div>';
        return;
      }

      try {
        const startTime = Date.now();
        const res = await fetch('http://localhost:8000/my_prompt.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profile })
        });
        const elapsed = Date.now() - startTime;

        const data = await res.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class="success">
âœ… PHP å¾Œç«¯æ¸¬è©¦æˆåŠŸï¼
â±ï¸  å›æ‡‰æ™‚é–“: ${elapsed}ms
ğŸ“Š å›å‚³è³‡æ–™:
${JSON.stringify(data.suggestions, null, 2)}
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="error">
âŒ API å›å‚³éŒ¯èª¤
è¨Šæ¯: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}
            </div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="error">
âŒ é€£ç·šå¤±æ•—
éŒ¯èª¤: ${err.message}

è«‹ç¢ºèªï¼š
1. PHP å¾Œç«¯å·²å•Ÿå‹• (php -S localhost:8000 æˆ– start_php.bat)
2. Port 8000 æ²’æœ‰è¢«å…¶ä»–ç¨‹å¼ä½”ç”¨
3. API Key å·²æ­£ç¢ºè¨­å®šåœ¨ my_prompt.php
4. PHP å·²å®‰è£ cURL æ“´å……åŠŸèƒ½
          </div>
        `;
      }
    }

    // æª¢æŸ¥é…ç½®
    function checkConfig() {
      const resultDiv = document.getElementById('configResult');
      const backendInfo = CONFIG.getBackendInfo();
      
      resultDiv.innerHTML = `
        <div class="info">
ğŸ“‹ ç•¶å‰é…ç½®:

å¾Œç«¯é¡å‹: ${CONFIG.BACKEND}
å¾Œç«¯åç¨±: ${backendInfo.name}
Port: ${backendInfo.port}
URL: ${backendInfo.url}
API ç«¯é»: ${CONFIG.getApiEndpoint()}
å•Ÿå‹•å‘½ä»¤: ${backendInfo.startCommand}

ğŸ’¡ å¦‚éœ€åˆ‡æ›å¾Œç«¯ï¼Œè«‹ç·¨è¼¯ config.js æª”æ¡ˆ
        </div>
      `;
    }

    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥é…ç½®
    window.addEventListener('DOMContentLoaded', () => {
      checkConfig();
    });
  </script>
</body>
</html>

